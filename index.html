<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ITI Infrastructure MIS</title>
    <style>
        :root { 
            --primary: #0e5774; 
            --accent: #167ba3; 
            --bg: #f4f7f9; 
            --card: #ffffff; 
            --text: #0a3d52; 
            --muted: #5c7c8a; 
            --border: #b0c4cc; 
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: "Times New Roman", Times, serif; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 10px; 
        }
        
        .container { 
            width: 100%; 
            max-width: 950px; 
            margin: auto; 
            background: var(--card); 
            border-radius: 8px; 
            padding: 15px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
            border: 1px solid var(--border);
        }
        
        .head-title { 
            border-bottom: 3px solid var(--primary); 
            padding-bottom: 10px; 
            margin-bottom: 20px; 
            text-align: center;
        }
        
        h2 { margin: 0; color: var(--primary); font-size: 1.5rem; text-transform: uppercase; }

        /* Summary Dashboard - Responsive Grid */
        .summary-dash {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        .summary-card {
            background: var(--primary);
            color: white;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
        }
        .summary-card label {
            display: block;
            font-size: 0.7rem;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .summary-card b { font-size: 1.3rem; }

        /* Quick Links */
        .quick-links { margin-bottom: 20px; }
        .btn-group { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
        .quick-btn { 
            padding: 6px 10px; 
            background: white; 
            border: 1px solid var(--primary); 
            color: var(--primary); 
            border-radius: 4px; 
            font-size: 0.8rem; 
            cursor: pointer; 
            font-weight: bold;
            font-family: inherit;
        }

        /* Controls - Stack on Mobile */
        .controls { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 15px; 
            margin-bottom: 20px; 
        }
        @media (min-width: 600px) {
            .controls { grid-template-columns: 1fr 1fr; }
            h2 { font-size: 1.8rem; }
            .container { padding: 25px; }
        }

        select, input { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid var(--primary); 
            border-radius: 4px; 
            font-size: 16px; /* Prevents auto-zoom on iOS */
            font-family: inherit;
        }

        .ribbon { 
            display: none; 
            background: var(--accent); 
            color: white; 
            padding: 10px; 
            border-radius: 4px; 
            margin-bottom: 15px; 
            text-align: center; 
            font-weight: bold; 
            font-size: 0.9rem;
        }

        /* Table Layout - Mobile Scrollable */
        .table-wrap { 
            border: 1px solid var(--primary); 
            border-radius: 4px; 
            overflow-x: auto; 
        }
        table { width: 100%; border-collapse: collapse; min-width: 400px; font-size: 14px; }
        th { background: var(--primary); color: white; padding: 10px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid var(--border); }
        tr:nth-child(even) { background: #e8f1f4; }
        
        .iti-name { font-weight: bold; color: var(--primary); }
        .val { font-weight: bold; text-align: center; color: var(--primary); }
        
        #last-sync { text-align: center; font-size: 0.7rem; color: var(--muted); margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="head-title"><h2>Infrastructure MIS Dashboard</h2></div>

    <div class="summary-dash">
        <div class="summary-card"><label>Total ITIs</label><b id="dashITI">105</b></div>
        <div class="summary-card"><label>Smart Class</label><b id="dashSmart">337</b></div>
        <div class="summary-card"><label>Total PCs</label><b id="dashComp">3650</b></div>
    </div>

    <div class="quick-links">
        <label style="font-weight: bold; color: var(--primary); font-size: 0.8rem;">Priority Districts:</label>
        <div class="btn-group">
            <button class="quick-btn" onclick="quickSelect('THIRUVANANTHAPURAM')">TVM</button>
            <button class="quick-btn" onclick="quickSelect('KOZHIKODE')">KOZ</button>
            <button class="quick-btn" onclick="quickSelect('KANNUR')">KAN</button>
            <button class="quick-btn" onclick="quickSelect('PALAKKAD')">PAL</button>
            <button class="quick-btn" onclick="quickSelect('KOLLAM')">KOL</button>
        </div>
    </div>

    <div class="controls">
        <div>
            <label style="font-size: 0.75rem; font-weight: bold;">SELECT DISTRICT</label>
            <select id="distDD"><option value="">-- Choose --</option></select>
        </div>
        <div>
            <label style="font-size: 0.75rem; font-weight: bold;">SEARCH ITI</label>
            <input type="text" id="subSearch" placeholder="Filter list..." disabled>
        </div>
    </div>

    <div id="ribbon" class="ribbon"></div>
    <div id="results" class="table-wrap">
        <div style="text-align: center; padding: 30px; color: var(--muted); font-style: italic;">Select a district to view data.</div>
    </div>
    
    <div id="last-sync">Syncing with Google Sheets...</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script>
    const URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQDIjjyfLI3OsCZtyutLe1ipOv4XHYJo7zjQgEQlfKRwf14uXMJ71iBnnWf1fLBtxWQxaKVU3-Lb_0R/pub?output=csv';
    let data = [];

    Papa.parse(URL, {
        download: true, header: true, skipEmptyLines: true,
        complete: function(res) {
            data = res.data.filter(r => r.District);
            const dists = [...new Set(data.map(r => r.District))].sort();
            const ddl = document.getElementById('distDD');
            dists.forEach(d => { if(d) ddl.add(new Option(d, d)); });
            document.getElementById('last-sync').innerText = "Live Data Synced at: " + new Date().toLocaleTimeString();
        }
    });

    function quickSelect(dist) {
        document.getElementById('distDD').value = dist;
        render();
    }

    function render() {
        const val = document.getElementById('distDD').value;
        const subQ = document.getElementById('subSearch').value.toLowerCase();
        const res = document.getElementById('results');
        const rib = document.getElementById('ribbon');
        const searchInput = document.getElementById('subSearch');

        if (!val) {
            res.innerHTML = '<div style="text-align: center; padding: 30px; color: var(--muted); font-style: italic;">Select a district to view data.</div>';
            rib.style.display = 'none';
            searchInput.disabled = true;
            return;
        }

        searchInput.disabled = false;
        const filtered = data.filter(i => i.District === val && i['Name of ITI'].toLowerCase().includes(subQ));
        let sTotal = 0, cTotal = 0;
        rib.style.display = 'block';

        if (filtered.length === 0) {
            res.innerHTML = '<div style="text-align: center; padding: 20px;">No matches found.</div>';
            rib.innerHTML = `District: ${val} | 0 Results`;
            return;
        }

        res.innerHTML = `
            <table>
                <thead>
                    <tr>
                        <th style="width:40px">Sl.</th>
                        <th>Name of ITI</th>
                        <th style="text-align:center;">Smart</th>
                        <th style="text-align:center;">PCs</th>
                    </tr>
                </thead>
                <tbody>
                    ${filtered.map((i, idx) => {
                        const s = parseInt(i['Smart Classrooms Required']) || 0;
                        const c = parseInt(i['Computers Required']) || 0;
                        sTotal += s; cTotal += c;
                        return `
                        <tr>
                            <td>${idx + 1}</td>
                            <td class="iti-name">${i['Name of ITI']}</td>
                            <td class="val">${s || '-'}</td>
                            <td class="val">${c || '-'}</td>
                        </tr>`;
                    }).join('')}
                </tbody>
            </table>`;
        
        rib.innerHTML = `${val} | Smart: ${sTotal} | Computers: ${cTotal}`;
    }

    document.getElementById('distDD').addEventListener('change', render);
    document.getElementById('subSearch').addEventListener('input', render);
</script>
</body>
</html>
